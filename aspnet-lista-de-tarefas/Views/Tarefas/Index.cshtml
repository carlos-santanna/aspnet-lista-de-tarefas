
@using System.Globalization;
@{
    ViewData["Title"] = "Página Inicial";
}

@{
    var tarefaSelected = 0;
    var nomeTarefaSelcted = "";
}

<h1>Tarefas</h1>

<a class="btn btn-primary" asp-action="Inserir"><i class="fas fa-add"></i> Nova tarefa</a>
<script type="text/javascript">
    function openDialogExcluir(id, nome) {
        alert(id + ' ' + nome);
    }
</script>
<div class="mt-3">
    <table class="table">
        <thead>
            <tr>
                <th>Nome</th>
                <th>Tipo</th>
                <th>Data</th>
                <th>Descrição</th>
                <th>Situação</th>
                <th>&nbsp;</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                @*@item.Tarefa.ToString()*@
                <tr>
                    <td>@item.Nome</td>
                    <td>
                        @switch (@item.TipoTarefaId)
                        {
                            case 1:<i class="fas fa-briefcase"></i>; break;
                            case 2:<i class="fas fa-graduation-cap"></i>; break;
                            case 3:<i class="fas fa-book"></i>; break;
                            case 4:<i class="fas fa-person"></i>; break;
                            default: <i class="fas fa-list-check"></i>; break;

                        }
                        @item.TipoTarefa.Tipo

                    </td>
                    <td>@item.DataExecucao.ToString("dd/MM/yyyy",CultureInfo.InvariantCulture)</td>
                    <td style="width:30%">@item.Descricao</td>

                    <td style="vertical-align: middle">

                        @switch (@item.StatusId)
                        {
                            case 1:<h5><span class="btn badge badge-secondary">@item.Status.Nome</span></h5>; break;
                        case 2:<h5><span class="btn badge badge-warning">@item.Status.Nome</span></h5>; break;
                    case 3:<h5><span class="btn badge badge-success">@item.Status.Nome</span></h5>; break;
                default:<h5><span class="btn badge badge-secondary">@item.Status.Nome</span></h5>; break;
        }

                    </td>
                    <td>
                        <a asp-action="Atualizar" asp-route-id="@item.TarefaId" class="btn btn-primary"><i class="fas fa-edit"></i></a>
                        <a data-id="@item.TarefaId" data-nome="@item.Nome" class="deleteBtn btn btn-danger"><i class="fas fa-trash"></i></a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>


<ModalExcluir></ModalExcluir>

<div class="modal fade" tabindex="-1" role="dialog" aria-backdrop="true" aria-modal="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Excluir Tarefa</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Deseja mesmo excluir a tarefa <strong class="nmTarefaExcluir"></strong>?</p>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="excluir()" class="btn btn-primary">Sim, continuar</button>
                <button type="button"  class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</div>


@section scripts{
    <script>
        var id = undefined;
        var nome = "";
        function excluir() {
            if (id > 0 && nome) {
                self.location.href = "/Tarefas/Excluir/" + id;
            }
        }
        $(function () {
            $(".deleteBtn").click(function () {
                let _id = $(this).attr("data-id");
                let _nome = $(this).attr("data-nome");
                if (parseInt(_id) > 0) {
                    id = _id;
                    nome = _nome;
                    $('.nmTarefaExcluir').html(nome);
                    $(".modal").modal();
                }

                
            });
        })
    </script>
}



